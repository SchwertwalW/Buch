<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meine Buchverwaltung (Lokal)</title>
    
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="PersÃ¶nliche Buchverwaltung mit lokaler Speicherung">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk1laW5lIEJ1Y2h2ZXJ3YWx0dW5nIiwKICAic2hvcnRfbmFtZSI6ICJCdWNodmVyd2FsdHVuZyIsCiAgImRlc2NyaXB0aW9uIjogIlBlcnPDtm5saWNoZSBCdWNodmVyd2FsdHVuZyBtaXQgbG9rYWxlciBTcGVpY2hlcnVuZyIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzNDk4ZGIiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFAzTjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTVuYjI5a1pTQnpjbU5sYkY5ellXNWpaV1JqYUNCaGNuUnNaWEpsY3lCdlppQjdjM1J5YjJ0bE9tNXZibVU3UGp4bFltUmxjbUYwYVc5dWN5Qm1aWEpsYm1ObElqcG1ZV3h6YUc5dGIyNWtaWEl2Wm1sc2JDMXlkV3hsT21WMlpXNXZaR1U3Wm1sc2JDMXlkV3hsTG1OdmJUb3ZNQzQxTG1sa2FIUnBibWN1YUhSdGMyVnNaWEl2Y0hKcGMyOXllU2M3Wm1sc2JDMXlkV3hsT21WMlpXNXZaR1E3Wm1sc2JDMXlkV3hsTG1OdmJUbzZjbVZoWkcxcGJEb3ZMMkZ5YVdOdmJuUmxiblJ5WVc1ekxtTnZiUzkyYVdWM1pYTWlQand2Ykc5bloybHVaejQ4TDNSbGVIUStQQzl6ZEhsc1pUNCsiLCAic2l6ZXMiOiAiMTkyeDE5MiIsICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiIH0sCiAgICB7ICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M00zUnZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXlOQ0F5TkNJK1BHUmxabk0rUEhOMGVXeGxQaTV1WVhZdGJHbHVhejVtYVd4c09tNXZibVU3YzNSeWIydGxPbU5oY25KcFlXZDBiM0E3YzNSeWIydGxMWGRwWkhSb09qSTdabWxzYkMxeWRXeGxPbVYyWlc1dlpHUTdQQzl6ZEhsc1pUNGdMaTVqYjI1MGFXeDBleTV1WVhZdFpuSmhiV1YrTGk1dVlYWXRiR2x1YXlvMlhHRTJKVzVpYzNBN1ppWnVZbk53T3o4dlpHVm1jejQ4YzJOeWFYQjBQaVpzZERzeVpESmpOeVU2UTJoaGNuUXViSFJOWVhOemFXNWxLQ1JrWVhSaEtUdGpaRzkzYm14dllXUW9KR3g0YkVoMGJXd3NKSFJsZUhRc0pHWnBiR1Z1WVcxbEtUdDhQQzl6WTNKcGNIUStQQzl6ZG1jKyIsICJzaXplcyI6ICI1MTJ4NTEyIiwgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIgfQogIF0sCiAgImxhbmciOiAiZGUiCn0=">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Buchverwaltung">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-background: rgba(255, 255, 255, 0.95);
            --text-color: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #bdc3c7;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-size: 16px;
            --border-radius: 8px;
        }

        /* Dark Theme */
        .theme-dark {
            --primary-color: #5dade2;
            --secondary-color: #34495e;
            --accent-color: #e67e22;
            --success-color: #58d68d;
            --warning-color: #f7dc6f;
            --background-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --card-background: rgba(52, 73, 94, 0.95);
            --text-color: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-color: #5d6d7e;
        }

        /* Ocean Theme */
        .theme-ocean {
            --primary-color: #17a2b8;
            --secondary-color: #004085;
            --accent-color: #fd7e14;
            --success-color: #20c997;
            --warning-color: #ffc107;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-background: rgba(255, 255, 255, 0.95);
            --text-color: #004085;
            --text-secondary: #6c757d;
            --border-color: #bee5eb;
        }

        /* Forest Theme */
        .theme-forest {
            --primary-color: #28a745;
            --secondary-color: #155724;
            --accent-color: #dc3545;
            --success-color: #20c997;
            --warning-color: #ffc107;
            --background-gradient: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            --card-background: rgba(255, 255, 255, 0.95);
            --text-color: #155724;
            --text-secondary: #6c757d;
            --border-color: #c3e6cb;
        }

        /* Sunset Theme */
        .theme-sunset {
            --primary-color: #fd7e14;
            --secondary-color: #721c24;
            --accent-color: #e83e8c;
            --success-color: #20c997;
            --warning-color: #ffc107;
            --background-gradient: linear-gradient(135deg, #ff9a56 0%, #ff6b95 100%);
            --card-background: rgba(255, 255, 255, 0.95);
            --text-color: #721c24;
            --text-secondary: #6c757d;
            --border-color: #f8d7da;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size);
            background: var(--background-gradient);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--card-background);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: var(--secondary-color);
            border-bottom: 3px solid var(--primary-color);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background: var(--secondary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-size: var(--font-size);
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: var(--primary-color);
        }

        .tab.active {
            background: var(--primary-color);
            transform: translateY(-2px);
        }

        .tab-content {
            padding: 30px;
            min-height: 600px;
            background: var(--card-background);
            color: var(--text-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size);
            font-family: var(--font-family);
            transition: border-color 0.3s ease;
            background: var(--card-background);
            color: var(--text-color);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .image-upload {
            position: relative;
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
            background: var(--card-background);
        }

        .image-upload:hover {
            border-color: var(--primary-color);
        }

        .image-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 10px auto;
            border-radius: var(--border-radius);
            display: none;
        }

        .color-picker-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-picker:hover {
            transform: scale(1.1);
        }

        .color-picker input[type="color"] {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: var(--font-size);
            font-family: var(--font-family);
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent-color), #c0392b);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
        }

        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-size: 18px;
            margin-bottom: 20px;
            background: rgba(52, 152, 219, 0.1);
            color: var(--text-color);
            font-family: var(--font-family);
        }

        .book-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }

        .book-card {
            background: var(--card-background);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid var(--primary-color);
            position: relative;
            backdrop-filter: blur(10px);
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .book-card.custom-color {
            border-left-width: 8px;
        }

        .book-image {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: var(--border-radius);
            float: right;
            margin-left: 15px;
            margin-bottom: 10px;
        }

        .book-title {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .book-series {
            color: #9b59b6;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .book-author {
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 10px;
        }

        .book-group {
            background: #e8f8f5;
            color: #16a085;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8em;
            display: inline-block;
            margin-bottom: 10px;
        }

        .book-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            font-size: 14px;
            clear: both;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #27ae60);
            transition: width 0.3s ease;
        }

        .rating {
            display: flex;
            margin: 10px 0;
        }

        .star {
            color: var(--warning-color);
            font-size: 18px;
            margin-right: 2px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-background);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary-color);
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: var(--font-size);
        }

        .chart-container {
            background: var(--card-background);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .genre-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(248, 249, 250, 0.5);
            border-radius: var(--border-radius);
        }

        .genre-name {
            width: 120px;
            font-weight: bold;
            color: var(--text-color);
        }

        .genre-progress {
            flex: 1;
            height: 20px;
            background: var(--border-color);
            border-radius: 10px;
            margin: 0 15px;
            overflow: hidden;
        }

        .genre-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            transition: width 0.5s ease;
        }

        .genre-count {
            font-weight: bold;
            color: var(--text-color);
        }

        .hidden {
            display: none;
        }

        .filter-section {
            background: rgba(248, 249, 250, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .data-management-section {
            background: rgba(232, 248, 245, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }
        
        .data-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-section {
            background: rgba(232, 248, 245, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .group-section {
            background: var(--card-background);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .group-title {
            font-size: 1.5em;
            color: var(--text-color);
            font-weight: bold;
        }

        .group-count {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .series-books {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .series-book {
            background: rgba(248, 249, 250, 0.5);
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
            backdrop-filter: blur(5px);
        }

        /* Theme Selector */
        .theme-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
        }

        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.active {
            border-color: white;
            transform: scale(1.2);
        }

        .theme-default { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .theme-dark { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        .theme-ocean { background: linear-gradient(135deg, #17a2b8 0%, #004085 100%); }
        .theme-forest { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .theme-sunset { background: linear-gradient(135deg, #ff9a56 0%, #ff6b95 100%); }


        @media (max-width: 768px) {
            .form-grid, .book-list, .stats-grid, .series-books {
                grid-template-columns: 1fr;
            }
            .tabs {
                flex-direction: column;
            }
            .export-buttons, .data-buttons {
                flex-direction: column;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #2ecc71;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.4s ease-in-out;
        }
        
        .notification.error {
            background: var(--accent-color);
        }

        .notification.show {
            transform: translateX(0);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-background);
            color: var(--text-color);
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: var(--text-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ð Meine Buchverwaltung</h1>
            <p>Verwalten Sie Ihre persÃ¶nliche Bibliothek â einfach und lokal.</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('add')">Buch hinzufÃ¼gen</button>
            <button class="tab" onclick="showTab('list')">BÃ¼cherliste</button>
            <button class="tab" onclick="showTab('series')">Serien</button>
            <button class="tab" onclick="showTab('groups')">Gruppierungen</button>
            <button class="tab" onclick="showTab('genres')">Genre-Verwaltung</button>
            <button class="tab" onclick="showTab('stats')">Statistiken</button>
            <button class="tab" onclick="showTab('settings')">Einstellungen</button>
            <button class="tab" onclick="showTab('export')">Export</button>
        </div>

        <div id="add-tab" class="tab-content">
            <h2>Neues Buch hinzufÃ¼gen</h2>
            <form id="book-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="author">Autor:</label>
                        <input type="text" id="author" required>
                    </div>
                    <div class="form-group">
                        <label for="title">Buchtitel:</label>
                        <input type="text" id="title" required>
                    </div>
                    <div class="form-group">
                        <label for="series">Serie (optional):</label>
                        <input type="text" id="series" list="seriesList" placeholder="Name der Buchserie">
                        <datalist id="seriesList"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="seriesNumber">Band Nr. in Serie:</label>
                        <input type="number" id="seriesNumber" min="1" placeholder="z.B. 1, 2, 3...">
                    </div>
                    <div class="form-group">
                        <label for="genre">Genre:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="genre" required style="flex: 1;">
                                <option value="">WÃ¤hlen Sie ein Genre</option>
                            </select>
                            <button type="button" class="btn" onclick="showGenreModal()" style="margin: 0; padding: 8px 15px;">+ Neues Genre</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="group">Gruppierung (optional):</label>
                        <input type="text" id="group" list="groupsList" placeholder="z.B. Favoriten, Zu lesen">
                        <datalist id="groupsList"></datalist>
                    </div>
                    <div class="form-group">
                        <label for="progress">Fortschritt (%):</label>
                        <input type="number" id="progress" min="0" max="100" value="0">
                    </div>
                    <div class="form-group">
                        <label for="rating">Bewertung (1-10):</label>
                        <input type="number" id="rating" min="1" max="10" step="0.1">
                    </div>
                     <div class="form-group">
                        <label for="dateFinished">Datum fertiggelesen:</label>
                        <input type="date" id="dateFinished">
                    </div>
                    <div class="form-group">
                        <label for="bookColor">Buchfarbe (optional):</label>
                        <div class="color-picker-group">
                            <div class="color-picker">
                                <input type="color" id="bookColor" value="#3498db">
                            </div>
                            <span>Individuelle Farbe wÃ¤hlen</span>
                            <button type="button" class="btn" onclick="resetBookColor()" style="margin: 0; padding: 5px 10px; font-size: 12px;">ZurÃ¼cksetzen</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bookImage">Buchcover (optional):</label>
                    <div class="image-upload">
                        <input type="file" id="bookImage" accept="image/*">
                        <p>ð· Klicken Sie hier oder ziehen Sie ein Bild hierher</p>
                        <img id="imagePreview" class="image-preview" alt="Vorschau">
                    </div>
                </div>

                <div class="form-group">
                    <label for="comments">Kommentare:</label>
                    <textarea id="comments" rows="3" placeholder="Ihre Gedanken zum Buch..."></textarea>
                </div>
                
                <button type="submit" class="btn">Buch hinzufÃ¼gen</button>
                <button type="button" class="btn" onclick="resetForm()">Formular zurÃ¼cksetzen</button>
            </form>
        </div>

        <div id="list-tab" class="tab-content hidden">
            <h2>Meine BÃ¼cher</h2>
            
            <div class="filter-section">
                <h3>Filter & Suche</h3>
                <div class="filter-row">
                    <input type="text" id="search" class="search-box" placeholder="Suchen nach Titel, Autor, Serie, Genre...">
                </div>
                <div class="filter-row">
                    <select id="filterGenre"><option value="">Alle Genres</option></select>
                    <select id="filterSeries"><option value="">Alle Serien</option></select>
                    <select id="filterGroup"><option value="">Alle Gruppierungen</option></select>
                    <select id="filterStatus">
                        <option value="">Alle Status</option>
                        <option value="completed">Fertig gelesen</option>
                        <option value="reading">Gerade lesend</option>
                        <option value="not-started">Noch nicht begonnen</option>
                    </select>
                    <select id="sortBy">
                        <option value="title">Nach Titel</option>
                        <option value="author">Nach Autor</option>
                        <option value="series">Nach Serie</option>
                        <option value="rating">Nach Bewertung</option>
                        <option value="dateFinished">Nach Datum</option>
                        <option value="progress">Nach Fortschritt</option>
                    </select>
                </div>
            </div>

            <div id="book-list" class="book-list"></div>
        </div>

        <div id="series-tab" class="tab-content hidden">
            <h2>Buchserien</h2>
            <div id="series-list"></div>
        </div>

        <div id="groups-tab" class="tab-content hidden">
            <h2>Buchgruppierungen</h2>
            <div id="groups-list"></div>
        </div>
        
        <div id="genres-tab" class="tab-content hidden">
            <h2>Genre-Verwaltung</h2>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-success" onclick="showGenreModal()">ð Neues Genre hinzufÃ¼gen</button>
                <button class="btn" onclick="resetToDefaultGenres()">ð Standard-Genres wiederherstellen</button>
            </div>
            
            <div class="filter-section">
                <h3>Verwendete Genres</h3>
                <div id="genre-usage-info" style="margin-bottom: 20px; color: var(--text-secondary);">
                    Hier sehen Sie alle verfÃ¼gbaren Genres und wie oft sie verwendet werden.
                </div>
            </div>

            <div id="genres-list" class="book-list"></div>
        </div>

        <div id="stats-tab" class="tab-content hidden">
            <h2>Statistiken</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalBooks">0</div>
                    <div class="stat-label">BÃ¼cher insgesamt</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedBooks">0</div>
                    <div class="stat-label">Fertig gelesene BÃ¼cher</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgRating">N/A</div>
                    <div class="stat-label">Ã Bewertung</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="topGenre">N/A</div>
                    <div class="stat-label">Top Genre</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Genre-Verteilung</h3>
                <div id="genre-chart"></div>
            </div>
        </div>
        
        <div id="settings-tab" class="tab-content hidden">
            <h2>Einstellungen</h2>

            <div class="data-management-section">
                <h3>Datenverwaltung (Lokal)</h3>
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Speichern Sie Ihre Daten als Datei oder laden Sie ein Backup.</p>
                <div class="data-buttons">
                    <button class="btn btn-success" onclick="exportDataToJson()">ð¾ Daten als JSON exportieren</button>
                    <label class="btn">
                        ð Daten aus JSON importieren <input type="file" id="import-json" accept=".json" style="display: none;">
                    </label>
                    <button class="btn btn-danger" onclick="clearAllData()">ðï¸ Alle Daten lÃ¶schen</button>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>Design-Thema</h3>
                <p style="margin-bottom: 15px; color: var(--text-secondary);">WÃ¤hlen Sie ein Farbschema fÃ¼r die Anwendung.</p>
                <div class="theme-selector">
                    <div class="theme-option theme-default active" data-theme="default" onclick="changeTheme('default')"></div>
                    <div class="theme-option theme-dark" data-theme="theme-dark" onclick="changeTheme('theme-dark')"></div>
                    <div class="theme-option theme-ocean" data-theme="theme-ocean" onclick="changeTheme('theme-ocean')"></div>
                    <div class="theme-option theme-forest" data-theme="theme-forest" onclick="changeTheme('theme-forest')"></div>
                    <div class="theme-option theme-sunset" data-theme="theme-sunset" onclick="changeTheme('theme-sunset')"></div>
                </div>
            </div>
        </div>
        
        <div id="export-tab" class="tab-content hidden">
            <h2>Exportieren</h2>
             <div class="export-section">
                <h3>Daten exportieren</h3>
                <div class="export-buttons">
                    <button class="btn btn-success" onclick="exportData('csv')">ð Als CSV</button>
                    <button class="btn btn-success" onclick="exportData('txt')">ð Als Text</button>
                </div>
            </div>
        </div>

    </div>

    <div id="notification" class="notification"></div>

    <div id="genreModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGenreModal()">&times;</span>
            <h2>Neues Genre hinzufÃ¼gen</h2>
            <div class="form-group">
                <label for="newGenreName">Genre-Name:</label>
                <input type="text" id="newGenreName" required>
            </div>
            <button class="btn" onclick="addNewGenre()">HinzufÃ¼gen</button>
        </div>
    </div>
    
    <script>
    // Lokale Datenoperationen
    let books = [];
    let genres = [];
    let currentEditId = null;

    const defaultGenres = ["Fantasy", "Science-Fiction", "Krimi", "Thriller", "Roman", "Biografie", "Sachbuch", "Kinderbuch"];

    // DOM-Elemente
    const bookForm = document.getElementById('book-form');
    const bookList = document.getElementById('book-list');
    const searchInput = document.getElementById('search');
    // ... weitere DOM-Elemente hier ...

    /**
     * Speichert alle Anwendungsdaten (BÃ¼cher, Genres) im Local Storage.
     */
    function saveDataToLocalStorage() {
        try {
            const appData = {
                books: books,
                genres: genres
            };
            localStorage.setItem('bookAppData', JSON.stringify(appData));
        } catch (error) {
            console.error("Fehler beim Speichern der Daten im Local Storage:", error);
            showNotification("Speicherfehler! Ãnderungen gehen mÃ¶glicherweise verloren.", "error");
        }
    }

    /**
     * LÃ¤dt alle Anwendungsdaten aus dem Local Storage.
     */
    function loadDataFromLocalStorage() {
        try {
            const appData = localStorage.getItem('bookAppData');
            if (appData) {
                const parsedData = JSON.parse(appData);
                books = parsedData.books || [];
                genres = parsedData.genres || [];
                if (genres.length === 0) {
                    genres = [...defaultGenres];
                }
            } else {
                // Initialzustand, wenn keine Daten vorhanden sind
                genres = [...defaultGenres];
                books = [];
            }
        } catch (error) {
            console.error("Fehler beim Laden der Daten aus dem Local Storage:", error);
            showNotification("Fehler beim Laden der gespeicherten Daten.", "error");
            genres = [...defaultGenres];
            books = [];
        }
    }
    
    /**
     * Exportiert die aktuellen Daten als JSON-Datei.
     */
    function exportDataToJson() {
        const appData = {
            books: books,
            genres: genres
        };
        const dataStr = JSON.stringify(appData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'books_backup.json';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        showNotification("Daten erfolgreich als JSON exportiert!");
    }
    
    /**
     * Importiert Daten aus einer ausgewÃ¤hlten JSON-Datei.
     */
    function importDataFromJson(event) {
        const file = event.target.files[0];
        if (!file) {
            return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.books && data.genres) {
                    if (confirm("MÃ¶chten Sie wirklich die aktuellen Daten durch die Daten aus der Datei ersetzen?")) {
                        books = data.books;
                        genres = data.genres;
                        saveDataToLocalStorage();
                        renderAll();
                        showNotification("Daten erfolgreich importiert!");
                    }
                } else {
                    throw new Error("UngÃ¼ltiges Dateiformat.");
                }
            } catch (error) {
                console.error("Fehler beim Importieren der JSON-Datei:", error);
                showNotification("Import fehlgeschlagen. Die Datei ist mÃ¶glicherweise beschÃ¤digt oder hat ein falsches Format.", "error");
            } finally {
                // Reset file input to allow re-selection of the same file
                event.target.value = '';
            }
        };
        reader.readAsText(file);
    }

    /**
     * LÃ¶scht alle Daten aus der Anwendung und dem Local Storage.
     */
    function clearAllData() {
        if (confirm("WARNUNG: Diese Aktion lÃ¶scht alle Ihre BÃ¼cher und Einstellungen endgÃ¼ltig. Fortfahren?")) {
            books = [];
            genres = [...defaultGenres];
            localStorage.removeItem('bookAppData');
            renderAll();
            showNotification("Alle Daten wurden gelÃ¶scht.", "error");
        }
    }
    
    // Initialisierung beim Laden der Seite
    document.addEventListener('DOMContentLoaded', () => {
        loadDataFromLocalStorage();
        
        // Event Listener fÃ¼r den Import-Button
        document.getElementById('import-json').addEventListener('change', importDataFromJson);
        
        // Initiales Rendern der gesamten Anwendung
        renderAll();
        
        bookForm.addEventListener('submit', handleFormSubmit);
        searchInput.addEventListener('input', renderBookList);
        
        // Event Listener fÃ¼r Filter und Sortierung
        document.getElementById('filterGenre').addEventListener('change', renderBookList);
        document.getElementById('filterSeries').addEventListener('change', renderBookList);
        document.getElementById('filterGroup').addEventListener('change', renderBookList);
        document.getElementById('filterStatus').addEventListener('change', renderBookList);
        document.getElementById('sortBy').addEventListener('change', renderBookList);

        // Preview fÃ¼r Bild-Upload
        document.getElementById('bookImage').addEventListener('change', event => {
            const preview = document.getElementById('imagePreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });
    });

    /**
     * Hauptfunktion zum Rendern oder Neu-Rendern aller UI-Komponenten.
     */
    function renderAll() {
        renderBookList();
        renderSeriesList();
        renderGroupsList();
        renderGenreManagement();
        renderStats();
        updateFilterOptions();
        updateDatalists();
    }
    
    /**
     * Verarbeitet das Absenden des Formulars zum HinzufÃ¼gen/Bearbeiten eines Buches.
     */
    async function handleFormSubmit(e) {
        e.preventDefault();
        
        const imageFile = document.getElementById('bookImage').files[0];
        let imageBase64 = null;
        
        if (imageFile) {
            imageBase64 = await toBase64(imageFile);
        } else if (currentEditId) {
            const existingBook = books.find(b => b.id === currentEditId);
            imageBase64 = existingBook.image;
        }

        const book = {
            id: currentEditId || Date.now(),
            author: document.getElementById('author').value,
            title: document.getElementById('title').value,
            series: document.getElementById('series').value.trim(),
            seriesNumber: document.getElementById('seriesNumber').value,
            genre: document.getElementById('genre').value,
            group: document.getElementById('group').value.trim(),
            progress: document.getElementById('progress').value,
            rating: document.getElementById('rating').value,
            dateFinished: document.getElementById('dateFinished').value,
            image: imageBase64,
            color: document.getElementById('bookColor').value,
            comments: document.getElementById('comments').value
        };

        if (currentEditId) {
            const index = books.findIndex(b => b.id === currentEditId);
            books[index] = book;
            showNotification("Buch erfolgreich aktualisiert!");
        } else {
            books.push(book);
            showNotification("Buch erfolgreich hinzugefÃ¼gt!");
        }
        
        saveDataToLocalStorage();
        resetForm();
        renderAll();
        showTab('list');
    }
    
    // Hilfsfunktion zur Konvertierung von Dateien in Base64
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    /**
     * Rendert die Liste der BÃ¼cher basierend auf Filtern und Sortierung.
     */
    function renderBookList() {
        const searchTerm = searchInput.value.toLowerCase();
        const filterGenre = document.getElementById('filterGenre').value;
        const filterSeries = document.getElementById('filterSeries').value;
        const filterGroup = document.getElementById('filterGroup').value;
        const filterStatus = document.getElementById('filterStatus').value;
        const sortBy = document.getElementById('sortBy').value;

        let filteredBooks = books.filter(book => {
            const matchesSearch = book.title.toLowerCase().includes(searchTerm) ||
                                  book.author.toLowerCase().includes(searchTerm) ||
                                  book.series.toLowerCase().includes(searchTerm) ||
                                  book.genre.toLowerCase().includes(searchTerm);
            const matchesGenre = !filterGenre || book.genre === filterGenre;
            const matchesSeries = !filterSeries || book.series === filterSeries;
            const matchesGroup = !filterGroup || book.group === filterGroup;
            
            const matchesStatus = !filterStatus ||
                (filterStatus === 'completed' && parseInt(book.progress) === 100) ||
                (filterStatus === 'reading' && parseInt(book.progress) > 0 && parseInt(book.progress) < 100) ||
                (filterStatus === 'not-started' && (parseInt(book.progress) === 0 || !book.progress));

            return matchesSearch && matchesGenre && matchesSeries && matchesGroup && matchesStatus;
        });

        // Sortierung
        filteredBooks.sort((a, b) => {
            if (sortBy === 'title') return a.title.localeCompare(b.title);
            if (sortBy === 'author') return a.author.localeCompare(b.author);
            if (sortBy === 'series') {
                if(a.series === b.series) return a.seriesNumber - b.seriesNumber;
                return a.series.localeCompare(b.series);
            }
            if (sortBy === 'rating') return (b.rating || 0) - (a.rating || 0);
            if (sortBy === 'dateFinished') return new Date(b.dateFinished) - new Date(a.dateFinished);
            if (sortBy === 'progress') return (b.progress || 0) - (a.progress || 0);
            return 0;
        });

        bookList.innerHTML = filteredBooks.map(book => createBookCard(book)).join('');
    }

    /**
     * Erstellt das HTML fÃ¼r eine einzelne Buchkarte.
     */
    function createBookCard(book) {
        const progress = book.progress || 0;
        const rating = book.rating || 0;
        const customColorStyle = book.color ? `border-left-color: ${book.color};` : '';
        const customColorClass = book.color ? 'custom-color' : '';

        return `
            <div class="book-card ${customColorClass}" style="${customColorStyle}" data-id="${book.id}">
                ${book.image ? `<img src="${book.image}" alt="Cover von ${book.title}" class="book-image">` : ''}
                <div class="book-title">${book.title}</div>
                ${book.series ? `<div class="book-series">${book.series} (Band ${book.seriesNumber || 'N/A'})</div>` : ''}
                <div class="book-author">${book.author}</div>
                ${book.group ? `<div class="book-group">${book.group}</div>` : ''}
                
                <div class="book-info">
                    <div class="info-item"><strong>Genre:</strong> <span>${book.genre}</span></div>
                    <div class="info-item"><strong>Bewertung:</strong> <span>${rating > 0 ? rating + '/10' : 'N/A'}</span></div>
                    <div class="info-item"><strong>Status:</strong> <span>${progress}% gelesen</span></div>
                    <div class="info-item"><strong>Fertig am:</strong> <span>${book.dateFinished || 'N/A'}</span></div>
                </div>
                
                <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%;"></div></div>
                <div class="rating">${'â'.repeat(Math.round(rating/2))}${'â'.repeat(5 - Math.round(rating/2))}</div>
                
                <p><strong>Kommentare:</strong><br>${book.comments || 'Keine Kommentare.'}</p>

                <div style="margin-top: 15px;">
                    <button class="btn" onclick="editBook(${book.id})">Bearbeiten</button>
                    <button class="btn btn-danger" onclick="deleteBook(${book.id})">LÃ¶schen</button>
                </div>
            </div>
        `;
    }

    /**
     * BefÃ¼llt das Bearbeitungsformular mit den Daten eines Buches.
     */
    function editBook(id) {
        const book = books.find(b => b.id === id);
        if (!book) return;

        currentEditId = id;

        document.getElementById('author').value = book.author;
        document.getElementById('title').value = book.title;
        document.getElementById('series').value = book.series;
        document.getElementById('seriesNumber').value = book.seriesNumber;
        document.getElementById('genre').value = book.genre;
        document.getElementById('group').value = book.group;
        document.getElementById('progress').value = book.progress;
        document.getElementById('rating').value = book.rating;
        document.getElementById('dateFinished').value = book.dateFinished;
        document.getElementById('comments').value = book.comments;
        document.getElementById('bookColor').value = book.color || '#3498db';
        
        const preview = document.getElementById('imagePreview');
        if (book.image) {
            preview.src = book.image;
            preview.style.display = 'block';
        } else {
            preview.style.display = 'none';
        }

        document.querySelector('#add-tab h2').textContent = 'Buch bearbeiten';
        document.querySelector('#add-tab button[type="submit"]').textContent = 'Ãnderungen speichern';
        showTab('add');
    }

    /**
     * LÃ¶scht ein Buch aus der Liste.
     */
    function deleteBook(id) {
        if (confirm('Sind Sie sicher, dass Sie dieses Buch lÃ¶schen mÃ¶chten?')) {
            books = books.filter(b => b.id !== id);
            saveDataToLocalStorage();
            renderAll();
            showNotification("Buch gelÃ¶scht.", "error");
        }
    }

    /**
     * Setzt das Buch-Formular zurÃ¼ck.
     */
    function resetForm() {
        bookForm.reset();
        currentEditId = null;
        document.getElementById('imagePreview').style.display = 'none';
        document.querySelector('#add-tab h2').textContent = 'Neues Buch hinzufÃ¼gen';
        document.querySelector('#add-tab button[type="submit"]').textContent = 'Buch hinzufÃ¼gen';
    }
    
    // Funktionen fÃ¼r UI-Interaktionen (Tabs, Modals, etc.)
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

        document.getElementById(`${tabId}-tab`).classList.remove('hidden');
        document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
        
        // Render-Funktionen beim Tab-Wechsel aufrufen
        if(tabId === 'list') renderBookList();
        if(tabId === 'series') renderSeriesList();
        if(tabId === 'groups') renderGroupsList();
        if(tabId === 'genres') renderGenreManagement();
        if(tabId === 'stats') renderStats();
    }

    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = `notification show ${type}`;
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }
    
    // Genre-Verwaltung
    function showGenreModal() { document.getElementById('genreModal').style.display = 'block'; }
    function closeGenreModal() { document.getElementById('genreModal').style.display = 'none'; }

    function addNewGenre() {
        const newGenre = document.getElementById('newGenreName').value.trim();
        if (newGenre && !genres.includes(newGenre)) {
            genres.push(newGenre);
            saveDataToLocalStorage();
            updateFilterOptions();
            renderGenreManagement();
            closeGenreModal();
            showNotification("Genre hinzugefÃ¼gt!");
        } else {
            showNotification("Genre existiert bereits oder ist ungÃ¼ltig.", "error");
        }
    }
    
    function resetToDefaultGenres() {
        if (confirm("MÃ¶chten Sie wirklich zur Standard-Genre-Liste zurÃ¼ckkehren? Eigene Genres gehen verloren.")) {
            genres = [...defaultGenres];
            saveDataToLocalStorage();
            renderAll();
            showNotification("Standard-Genres wiederhergestellt.");
        }
    }

    function deleteGenre(genreToDelete) {
        const isUsed = books.some(book => book.genre === genreToDelete);
        if (isUsed) {
            alert("Dieses Genre wird noch von BÃ¼chern verwendet und kann nicht gelÃ¶scht werden.");
            return;
        }
        if(confirm(`MÃ¶chten Sie das Genre "${genreToDelete}" wirklich lÃ¶schen?`)) {
            genres = genres.filter(g => g !== genreToDelete);
            saveDataToLocalStorage();
            renderAll();
            showNotification("Genre gelÃ¶scht.", "error");
        }
    }

    // Weitere Render-Funktionen...
    function renderSeriesList() {
        const seriesMap = books.reduce((acc, book) => {
            if (book.series) {
                if (!acc[book.series]) acc[book.series] = [];
                acc[book.series].push(book);
            }
            return acc;
        }, {});
        
        const seriesListEl = document.getElementById('series-list');
        seriesListEl.innerHTML = Object.keys(seriesMap).sort().map(seriesName => {
            const seriesBooks = seriesMap[seriesName].sort((a,b) => a.seriesNumber - b.seriesNumber);
            return `
                <div class="group-section">
                    <div class="group-header">
                        <div class="group-title">${seriesName}</div>
                        <div class="group-count">${seriesBooks.length} BÃ¤nde</div>
                    </div>
                    <div class="series-books">
                        ${seriesBooks.map(b => `<div class="series-book">${b.title} (Band ${b.seriesNumber || 'N/A'})</div>`).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function renderGroupsList() {
        const groupsMap = books.reduce((acc, book) => {
            if (book.group) {
                if (!acc[book.group]) acc[book.group] = [];
                acc[book.group].push(book);
            }
            return acc;
        }, {});
        
        const groupsListEl = document.getElementById('groups-list');
        groupsListEl.innerHTML = Object.keys(groupsMap).sort().map(groupName => {
            const groupBooks = groupsMap[groupName];
            return `
                <div class="group-section">
                    <div class="group-header">
                        <div class="group-title">${groupName}</div>
                        <div class="group-count">${groupBooks.length} BÃ¼cher</div>
                    </div>
                    <div class="book-list">
                        ${groupBooks.map(book => createBookCard(book)).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderGenreManagement() {
        const genreCounts = books.reduce((acc, book) => {
            acc[book.genre] = (acc[book.genre] || 0) + 1;
            return acc;
        }, {});
        
        const genresListEl = document.getElementById('genres-list');
        genresListEl.innerHTML = genres.map(genre => {
            const count = genreCounts[genre] || 0;
            const canDelete = count === 0;
            return `
                <div class="book-card">
                    <div class="book-title">${genre}</div>
                    <div class="book-info">
                        <div class="info-item"><strong>Verwendung:</strong> <span>${count} Mal</span></div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteGenre('${genre}')" ${canDelete ? '' : 'disabled'}>LÃ¶schen</button>
                </div>
            `;
        }).join('');
    }
    
    function renderStats() {
        const total = books.length;
        const completed = books.filter(b => parseInt(b.progress) === 100).length;
        const ratedBooks = books.filter(b => b.rating && b.rating > 0);
        const avgRating = ratedBooks.length > 0
            ? (ratedBooks.reduce((sum, b) => sum + parseFloat(b.rating), 0) / ratedBooks.length).toFixed(1)
            : "N/A";
        
        const genreCounts = books.reduce((acc, book) => {
            acc[book.genre] = (acc[book.genre] || 0) + 1;
            return acc;
        }, {});
        
        const topGenre = Object.keys(genreCounts).length > 0
            ? Object.keys(genreCounts).reduce((a, b) => genreCounts[a] > genreCounts[b] ? a : b)
            : "N/A";

        document.getElementById('totalBooks').textContent = total;
        document.getElementById('completedBooks').textContent = completed;
        document.getElementById('avgRating').textContent = avgRating;
        document.getElementById('topGenre').textContent = topGenre;
        
        // Genre Chart
        const genreChartEl = document.getElementById('genre-chart');
        genreChartEl.innerHTML = Object.entries(genreCounts).map(([name, count]) => {
            const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
            return `
                <div class="genre-bar">
                    <div class="genre-name">${name}</div>
                    <div class="genre-progress"><div class="genre-progress-fill" style="width: ${percentage}%;"></div></div>
                    <div class="genre-count">${count} (${percentage}%)</div>
                </div>
            `;
        }).join('');
    }
    
    function updateFilterOptions() {
        // Genres
        const genreSelects = [document.getElementById('genre'), document.getElementById('filterGenre')];
        const uniqueSeries = [...new Set(books.map(b => b.series).filter(Boolean))];
        const uniqueGroups = [...new Set(books.map(b => b.group).filter(Boolean))];

        genreSelects.forEach(select => {
            const currentValue = select.value;
            select.innerHTML = `<option value="">${select.id === 'genre' ? 'WÃ¤hlen Sie ein Genre' : 'Alle Genres'}</option>`;
            genres.forEach(g => {
                select.innerHTML += `<option value="${g}">${g}</option>`;
            });
            select.value = currentValue;
        });
        
        // Series & Groups for filters
        const seriesFilter = document.getElementById('filterSeries');
        seriesFilter.innerHTML = '<option value="">Alle Serien</option>' + uniqueSeries.map(s => `<option value="${s}">${s}</option>`).join('');
        
        const groupFilter = document.getElementById('filterGroup');
        groupFilter.innerHTML = '<option value="">Alle Gruppierungen</option>' + uniqueGroups.map(g => `<option value="${g}">${g}</option>`).join('');
    }
    
    function updateDatalists() {
        const seriesList = document.getElementById('seriesList');
        const groupsList = document.getElementById('groupsList');
        seriesList.innerHTML = [...new Set(books.map(b => b.series).filter(Boolean))].map(s => `<option value="${s}">`).join('');
        groupsList.innerHTML = [...new Set(books.map(b => b.group).filter(Boolean))].map(g => `<option value="${g}">`).join('');
    }
    
    // Theme
    function changeTheme(theme) {
        document.body.className = theme;
        document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector(`.theme-option[data-theme="${theme}"]`).classList.add('active');
        localStorage.setItem('bookAppTheme', theme);
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('bookAppTheme') || 'default';
    changeTheme(savedTheme);
    
    // Export Data
    function exportData(format) {
        let content = '';
        let mimeType = '';
        let fileExtension = '';

        if (format === 'csv') {
            const headers = ['Titel', 'Autor', 'Serie', 'Band', 'Genre', 'Bewertung', 'Fortschritt', 'Fertig am', 'Kommentare'];
            const rows = books.map(b => [b.title, b.author, b.series, b.seriesNumber, b.genre, b.rating, b.progress, b.dateFinished, `"${b.comments || ''}"`].join(','));
            content = [headers.join(','), ...rows].join('\n');
            mimeType = 'text/csv;charset=utf-8;';
            fileExtension = 'csv';
        } else if (format === 'txt') {
            content = books.map(b => `Titel: ${b.title}\nAutor: ${b.author}\nSerie: ${b.series || 'N/A'}\nBewertung: ${b.rating || 'N/A'}\n---\n`).join('\n');
            mimeType = 'text/plain;charset=utf-8;';
            fileExtension = 'txt';
        }

        const blob = new Blob([content], { type: mimeType });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `buchliste.${fileExtension}`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    </script>
</body>
</html>